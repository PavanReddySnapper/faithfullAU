import{M as u}from"./modal-dialog-3a8651fe.js";var p="query countries($locale: SupportedLocale!) {  countries(locale: $locale) {    name    code    labels {      address1      address2      city      company      country      firstName      lastName      phone      postalCode      zone    }    formatting {      edit    }    zones {      name      code    }  }}",f="https://country-service.shopifycloud.com/graphql";function h(t){var e=fetch(f,{method:"POST",headers:{"Content-Type":"application/json","Access-Control-Allow-Origin":"*"},body:JSON.stringify({query:p,operationName:"countries",variables:{locale:g(t)}})});return e.then(function(r){return r.json()}).then(function(r){return r.data.countries})}var m="EN",d=["DA","DE","EN","ES","FR","IT","JA","NL","PT","PT_BR"];function g(t){var e=t.replace(/-/,"_").toUpperCase();return d.indexOf(e)!==-1?e:d.indexOf(e.substring(0,2))!==-1?e.substring(0,2):m}function v(){for(var t=Object({}),e=0;e<arguments.length;e++){var r=arguments[e];if(r)for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(t[s]=r[s])}return t}var y=/({\w+})/g,C="_",l={lastName:'[name="address[last_name]"]',firstName:'[name="address[first_name]"]',company:'[name="address[company]"]',address1:'[name="address[address1]"]',address2:'[name="address[address2]"]',country:'[name="address[country]"]',zone:'[name="address[province]"]',postalCode:'[name="address[zip]"]',city:'[name="address[city]"]',phone:'[name="address[phone]"]'};function F(t,e,r){e=e||"en",r=r||{inputSelectors:{}};var s=D(t,v(l,r.inputSelectors));return S(s),M(r.shippingCountriesOnly).then(function(a){return h(e).then(function(n){b(t,s,N(n,a))})})}function b(t,e,r){E(e,r);var s=e.country.input?e.country.input.value:null;L(t,e,r),c(t,e,s,r)}function c(t,e,r,s){var a=w(r,s);T(e,a),A(t,e,a),q(e,a)}function L(t,e,r){e.country.input.addEventListener("change",function(s){c(t,e,s.target.value,r)})}function A(t,e,r){var s=r.formatting.edit,a=e.country.wrapper,n=!1;O(s).forEach(function(i){i.forEach(function(o){if(e[o].wrapper.dataset.lineCount=i.length,!!e[o].wrapper){if(o==="country"){n=!0;return}n?t.append(e[o].wrapper):t.insertBefore(e[o].wrapper,a)}})})}function T(t,e){Object.keys(t).forEach(function(r){t[r].labels.forEach(function(s){s.textContent=e.labels[r]})})}function E(t,e){var r=t.country.input,s=r.cloneNode(!0);e.forEach(function(a){var n=document.createElement("option");n.value=a.code,n.textContent=a.name,s.appendChild(n)}),r.innerHTML=s.innerHTML,r.dataset.default&&(r.value=r.dataset.default)}function q(t,e){var r=t.zone;if(r){if(e.zones.length===0){r.wrapper.dataset.ariaHidden="true",r.input.innerHTML="";return}r.wrapper.dataset.ariaHidden="false";var s=r.input,a=s.cloneNode(!0);a.innerHTML="",e.zones.forEach(function(n){var i=document.createElement("option");i.value=n.code,i.textContent=n.name,a.appendChild(i)}),s.innerHTML=a.innerHTML,s.dataset.default&&(s.value=s.dataset.default)}}function S(t){Object.keys(t).forEach(function(e){var r=t[e].input,s=t[e].labels;if(r){if(typeof r!="object")throw new TypeError(t[e]+" is missing an input or select.");if(typeof s!="object")throw new TypeError(t[e]+" is missing a label.")}})}function w(t,e){return t=t||"CA",e.filter(function(r){return r.code===t})[0]}function O(t){return t.split(C).map(function(e){var r=e.match(y);return r?r.map(function(s){var a=s.replace(/[{}]/g,"");switch(a){case"zip":return"postalCode";case"province":return"zone";default:return a}}):[]})}function D(t,e){var r={};return Object.keys(l).forEach(function(s){var a=t.querySelector(e[s]);r[s]=a?{wrapper:a.parentElement,input:a,labels:document.querySelectorAll('[for="'+a.id+'"]')}:{}}),r}function M(t){if(!t)return Promise.resolve(null);var e=fetch(location.origin+"/meta.json");return e.then(function(r){return r.json()}).then(function(r){return r.ships_to_countries.indexOf("*")!==-1?null:r.ships_to_countries}).catch(function(){return null})}function N(t,e){return e?t.filter(function(r){return e.indexOf(r.code)!==-1}):t}class _ extends HTMLElement{constructor(){super(),this.selectors={collapsableAddressForm:"[data-collapsable-address-form]",addressForm:"[data-address-form]",addressFormFields:"[data-address-fields]",addressRequiredField:"[data-required]",addressCountry:'[name="address[country]"]',addressDeleteForm:"[data-address-delete-form]",addressCancel:"[data-address-cancel]",formTrigger:"[data-address-form-trigger]",formCancelTrigger:"[data-address-form-cancel-trigger]",modal:".modal"},this.isModal=this.getAttribute("data-is-modal")==="true",this.addressForm=this.querySelector(this.selectors.addressForm),this.addressFields=this.addressForm.querySelector(this.selectors.addressFormFields),this.formTriggers=this.querySelectorAll(this.selectors.formTrigger),this.formCancelTriggers=this.querySelectorAll(this.selectors.formCancelTrigger),this.initAddressForm(),this.isModal?this.initModal():this.initCollapsableAddressForm()}initModal(){const e=this.querySelector(this.selectors.modal),r=e.getAttribute("id").replace("modal-","");new u(e,{triggerEl:this.formTriggers,modalId:r})}initCollapsableAddressForm(){const e=this.querySelector(this.selectors.collapsableAddressForm),r=n=>{n.preventDefault(),e.setAttribute("aria-expanded","true")},s=n=>{n.preventDefault(),e.setAttribute("aria-expanded","false")};this.formTriggers.forEach(n=>{n.addEventListener("click",i=>{n.parentElement.querySelector(this.selectors.formCancelTrigger).classList.remove("hide"),n.classList.add("hide"),r(i)})}),this.formCancelTriggers.forEach(n=>{n.addEventListener("click",i=>{n.parentElement.querySelector(this.selectors.formTrigger).classList.remove("hide"),n.classList.add("hide"),s(i)})});const a=this.querySelector(this.selectors.addressCancel);a==null||a.addEventListener("click",n=>{const i=a.closest("address-card");i.querySelector(this.selectors.formTrigger).classList.remove("hide"),i.querySelector(this.selectors.formCancelTrigger).classList.add("hide"),s(n)})}initAddressForm(){F(this.addressFields,window.theme.locale.isoCode,{shippingCountriesOnly:this.addressFields.dataset.addressLimitCountries==="true"});const e=this.addressFields.querySelector(this.selectors.addressCountry);e==null||e.addEventListener("change",()=>this.handleFieldVisibility());const r=this.querySelector(this.selectors.addressDeleteForm);r==null||r.addEventListener("submit",this.handleAddressDelete)}handleFieldVisibility(){requestAnimationFrame(()=>{Array.from(this.addressFields.querySelectorAll(this.selectors.addressRequiredField)).forEach(r=>{if(r.parentElement.dataset.ariaHidden==="true"){r.required=!1;return}r.required=!0})})}handleAddressDelete(e){const r=e.currentTarget.getAttribute("data-confirm-message");window.confirm(r||"Are you sure you wish to delete this address?")||e.preventDefault()}}function H(){customElements.define("address-card",_)}export{H as i};

import{g as m}from"./getFormProperties-b031bb9f.js";import{W as C,a as T}from"./wishlist-icons-cb938bca.js";function L(){class p extends HTMLElement{constructor(){var e;super(),this.selectors={addToCartForm:"[data-product-card-form]",addToCartButton:"[data-add-to-cart]",addToCartText:"[data-add-to-cart-text]",selectedVariantRadio:'input[name="id"][type="radio"]:checked',selectedVariantDefault:'[name="id"]',swatchesContainer:"[data-product-swatches]",swatch:"[data-product-swatch]",wishlistButton:"[data-wishlist-icon]"},this.classes={swatchActive:"swatch--active"},this.addToCartForm=this.querySelector(this.selectors.addToCartForm),this.addToCartButton=this.querySelector(this.selectors.addToCartButton),this.addToCartText=this.querySelector(this.selectors.addToCartText),this.swatches=this.querySelectorAll(this.selectors.swatch),this.product=JSON.parse(this.getAttribute("product")),this.strings={addedToCart:window.theme.strings.addedToCart,addToCart:((e=this.addToCartButton)==null?void 0:e.dataset.label)??window.theme.strings.addToCart},this.initForm(),this.initSwatches(),this.initWishlist()}initWishlist(){const e=this.querySelector(this.selectors.wishlistButton);if(!e)return;const t=a=>{var l,n;a.preventDefault();const o=((l=this.addToCartForm.querySelector('[name="id"]:checked'))==null?void 0:l.value)??((n=this.addToCartForm.querySelector('[name="id"]'))==null?void 0:n.value),h=this.product.variants.find(s=>s.id===parseInt(o,10)),d={epi:h.id,du:`${window.location.origin}/products/${this.product.handle}`,empi:parseInt(this.product.id,10),pr:h.price},u=s=>{window.SwymCallbacks||(window.SwymCallbacks=[]),window.SwymCallbacks.push(s)},c=(s,i)=>{window._swat.addToWishList(d,r=>{s(r),e.classList.add("swym-added"),window.dispatchEvent(new CustomEvent(C,{detail:{product:this.product.id}}))},r=>{i(r)})},w=(s,i)=>{window._swat.removeFromWishList(d,r=>{s(r),e.classList.remove("swym-added"),window.dispatchEvent(new CustomEvent(T,{detail:{product:this.product.id}}))},r=>{i(r)})};new Promise((s,i)=>{u(()=>{e.classList.contains("swym-added")?w(s,i):c(s,i)})})};e.addEventListener("click",t)}addToCartCallback(){this.addToCartButton.removeAttribute("disabled"),this.addToCartText.innerText=this.strings.addedToCart,setTimeout(()=>{this.addToCartText.innerText=this.strings.addToCart},2e3)}initForm(){this.addToCartForm&&this.addToCartForm.addEventListener("submit",e=>{e.preventDefault();const t=this.querySelector(this.selectors.selectedVariantRadio)??this.querySelector(this.selectors.selectedVariantDefault);if(!t)return;this.addToCartButton.setAttribute("disabled","");const a={id:parseInt(t.value,10),quantity:1,properties:m(this.addToCartForm)};window.sideCart.handleAddToCartEvent(a,!0,this.addToCartCallback.bind(this))})}initSwatches(){if(!this.swatches.length)return;this.swatches.forEach(t=>t.addEventListener("click",this.getProduct.bind(this))),sessionStorage.getItem(`product_card:${this.dataset.productCard}`)||sessionStorage.setItem(`product_card:${this.dataset.productCard}`,this.outerHTML)}async getProduct(e){var u;e.preventDefault();const t=e.currentTarget;if(t.classList.contains(this.classes.swatchActive))return;this.swatches.forEach(c=>c.classList.remove(this.classes.swatchActive)),t.classList.add(this.classes.swatchActive);const a=sessionStorage.getItem(`product_card:${t.dataset.product}`);if(a){this.replaceProduct(a);return}const h=`${(u=window.theme.locale)!=null&&u.primary?"":window.theme.locale.rootUrl}/products/${t.dataset.product}?view=card`,d=await fetch(h);if(d.ok){const c=await d.text(),n=new DOMParser().parseFromString(c,"text/html").querySelector("product-card");sessionStorage.setItem(`product_card:${t.dataset.product}`,n.outerHTML),this.replaceProduct(n.outerHTML)}}replaceProduct(e){const t=document.createElement("div");t.innerHTML=e;const a=this.querySelector(this.selectors.swatchesContainer),o=t.querySelector(this.selectors.swatchesContainer);a&&o&&(o.outerHTML=a.outerHTML),this.outerHTML=t.innerHTML,t.remove()}}customElements.define("product-card",p)}export{L as i};
